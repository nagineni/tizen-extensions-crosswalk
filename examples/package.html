<html>
<head>
  <meta name="viewport" content="width=device-width">
</head>

<h1>Tizen Package API</h1>
<body>
<button onClick="handleCleanConsole()">Clean</button>
<button onClick="handleInstall()">Install</button>
<button onClick="handleUnInstall()">UnInstall</button>
<button onClick="handleGetPackage()">GetPackage</button>
<button onClick="handleGetPackages()">GetPackages</button>
<button onClick="enableEvents()">Listener (ON)</button>
<button onClick="disableEvents()">Listener (OFF)</button>


<pre id="console"></pre>
<script src="js/js-test-pre.js"></script>
<script>

function handleCleanConsole()
{
  var el = document.getElementById("console");
  while (el.firstChild)
    el.removeChild(el.firstChild);
}

var onInstallation = {
  onprogress: function(packageId, percentage) {
    debug("On installation(" + packageId + ") : progress(" + percentage + ")");
  },
  oncomplete: function(packageId) {
    debug("Installation(" + packageId + ") Complete");
  }
};

var onUninstallation = {
  onprogress: function(packageId, percentage) {
    debug("On Uninstallation(" + packageId + ") : progress(" + percentage + ")");
  },
  oncomplete: function(packageId) {
   debug("Uninstallation(" + packageId + ") Complete");
  }
};

var onError = function (err) {
  console.log("Error occurred Install/UnInstall : " + err.name);
}

function onListInstalledPackages(packages) {
  for (var i = 0; i < packages.length; i++) {
    console.log("Package id["+i+"] : " +packages[i].id);
  }
}

function handleInstall()
{
  try {
    debug('tizen.package.install:');
    // Let's assume that "HangOnMan.wgt" file exists in the downloads directory
    tizen.filesystem.resolve("downloads/tct-filesystem-tizen-tests.wgt",
       function (file) {
          console.log("file path : " + file.path);
          tizen.package.install(file.toURI(), onInstallation, onError);
     },
     function (err) {
        console.log("file path : " + file.path);
        console.log("Error occurred on resolve : " + err.name);
     },
     "r");
  } catch (err) {
    debug(err.name);
  }
}

function handleUnInstall()
{
  try {
  // Let's assume that the package id to uninstall is "HangOnMan"
  tizen.package.uninstall("tct-filesystem-tizen-tests", onUninstallation, onError);
  }
  catch (err) {
    debug(err.name);
  }

}

function handleGetPackage()
{
  // If the ID is set to null or not set at all, it returns package
  // information of the current application
  try {
    var packageInfo = tizen.package.getPackageInfo(null);
    console.log("Current Package ID : " + packageInfo.id);
  } catch (err) {
    debug(err.name);
  }
}

function handleGetPackages()
{
  // TODO(riju): Not implemented yet
  console.log("Not implemented");
}

var packageEventCallback = {
  oninstalled: function(packageInfo) {
    console.log('The package ' + packageInfo.name + ' is installed');
  },
  onupdated: function(packageInfo) {
    console.log('The package ' + packageInfo.name + ' is updated');
  },
  onuninstalled: function(packageId) {
    console.log('The package ' + packageId + ' is uninstalled');
  }
};

function enableEvents() {
  try {
    debug('tizen.package.setPackageInfoEventListener:');
    tizen.package.setPackageInfoEventListener(packageEventCallback);
  } catch (err) {
    debug(err.name);
  }
}

function disableEvents() {
  try {
    debug('tizen.package.unsetPackageInfoEventListener:');
    tizen.package.unsetPackageInfoEventListener();
  } catch (err) {
    debug(err.name);
  }
}

</script>
</body>
</html>
